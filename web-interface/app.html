<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, interactive-widget=resizes-content">
    <title>Stylisti - AI Style Assistant</title>
    
    <!-- PWA Configuration -->
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Stylisti">
    <meta name="theme-color" content="#8b2635">
    <meta name="msapplication-TileColor" content="#8b2635">
    <meta name="msapplication-TileImage" content="/icon-192.png">
    <link rel="apple-touch-icon" href="/icon-192.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/icon-512.png">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #1a1a1a;
            --secondary-color: #f8f9fa;
            --accent-color: #8b2635;
            --accent-light: #f4e6e8;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --text-light: #9ca3af;
            --border-color: #e5e7eb;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --gradient-primary: linear-gradient(135deg, #8b2635 0%, #a53860 100%);
            --gradient-secondary: linear-gradient(135deg, #d4a574 0%, #8b2635 100%);
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(180deg, #fafafa 0%, #f4f4f5 100%);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            padding-bottom: 80px;
            -webkit-overflow-scrolling: touch;
            position: relative;
        }

        /* Login Page Styles */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            background: linear-gradient(135deg, #8b2635 0%, #a53860 50%, #d4a574 100%);
        }

        .login-card {
            background: white;
            border-radius: 24px;
            padding: 40px 32px;
            box-shadow: var(--shadow-xl);
            width: 100%;
            max-width: 400px;
            text-align: center;
            animation: slideUp 0.6s ease-out;
        }

        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .login-logo {
            font-size: 36px;
            font-weight: 700;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }

        .login-subtitle {
            font-size: 16px;
            color: var(--text-secondary);
            margin-bottom: 32px;
        }

        .login-form {
            text-align: left;
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .form-input {
            width: 100%;
            padding: 16px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            font-size: 16px;
            outline: none;
            transition: border-color 0.2s ease;
            background: white;
        }

        .form-input:focus {
            border-color: var(--accent-color);
        }

        .login-button {
            width: 100%;
            padding: 16px;
            background: var(--gradient-primary);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
            margin-top: 8px;
        }

        .login-button:hover {
            transform: translateY(-2px);
        }

        .login-button:active {
            transform: translateY(0);
        }

        .password-hint {
            font-size: 12px;
            color: var(--text-light);
            margin-top: 8px;
            text-align: center;
        }

        .error-message {
            color: #ef4444;
            font-size: 14px;
            margin-top: 8px;
            text-align: center;
        }

        /* App Container */
        .app {
            max-width: 100vw;
            min-height: 100vh;
            position: relative;
            display: none;
        }

        .app.authenticated {
            display: block;
        }

        /* Page Views */
        .page {
            display: none;
            padding: 16px 16px 100px 16px;
            min-height: 100vh;
            animation: slideIn 0.3s ease-out;
            overflow-y: auto;
            position: relative;
        }

        .page.active {
            display: block;
        }

        @keyframes slideIn {
            from { transform: translateX(20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 24px;
            padding-top: calc(env(safe-area-inset-top, 20px) + 8px);
        }

        .logo {
            font-size: 28px;
            font-weight: 700;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 6px;
            letter-spacing: -0.02em;
        }

        .tagline {
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 400;
            opacity: 0.8;
        }

        /* Feature Cards */
        .feature-grid {
            display: grid;
            gap: 20px;
            margin-bottom: 40px;
        }

        .feature-card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .feature-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .feature-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-primary);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .feature-card:hover::before {
            opacity: 1;
        }

        .feature-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            background: var(--accent-light);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 16px;
            color: var(--accent-color);
            font-size: 20px;
        }

        .feature-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .feature-description {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        /* Dashboard Cards */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 20px;
        }

        .dashboard-card {
            background: white;
            border-radius: 16px;
            padding: 16px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            transition: transform 0.2s ease;
        }

        .dashboard-card:active {
            transform: scale(0.98);
        }

        .dashboard-icon {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            background: var(--accent-light);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 12px;
            color: var(--accent-color);
            font-size: 16px;
        }

        .dashboard-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .dashboard-subtitle {
            font-size: 12px;
            color: var(--text-light);
        }

        /* Upload Interface */
        .upload-area {
            background: white;
            border: 2px dashed var(--border-color);
            border-radius: 20px;
            padding: 32px 20px;
            text-align: center;
            transition: all 0.3s ease;
            margin-bottom: 16px;
            cursor: pointer;
        }

        .upload-area:hover, .upload-area.dragover {
            border-color: var(--accent-color);
            background: var(--accent-light);
        }

        .upload-icon {
            width: 64px;
            height: 64px;
            margin: 0 auto 16px;
            background: var(--accent-light);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--accent-color);
            font-size: 24px;
        }

        .upload-text {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .upload-subtext {
            font-size: 14px;
            color: var(--text-secondary);
        }

        /* Form Styles */
        .form-section {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
        }

        .form-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--text-primary);
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-label {
            display: block;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--text-primary);
        }

        .tag-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .tag-option {
            padding: 12px 16px;
            background: var(--secondary-color);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            text-align: center;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 48px;
        }

        .tag-option:hover {
            border-color: var(--accent-color);
            background: var(--accent-light);
        }

        .tag-option.selected {
            background: var(--accent-color);
            border-color: var(--accent-color);
            color: white;
        }

        .form-textarea {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            font-size: 15px;
            resize: vertical;
            min-height: 80px;
            font-family: inherit;
            outline: none;
            transition: border-color 0.2s ease;
        }

        .form-textarea:focus {
            border-color: var(--accent-color);
        }

        .upload-button {
            width: 100%;
            padding: 16px;
            background: var(--gradient-primary);
            color: white;
            border: none;
            border-radius: 16px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .upload-button:hover {
            transform: translateY(-2px);
        }

        .upload-button:active {
            transform: translateY(0);
        }

        /* Timeline Styles */
        .timeline {
            padding: 16px 0;
        }

        .timeline-item {
            border-left: 2px solid var(--border-color);
            padding-left: 16px;
            margin-bottom: 16px;
            position: relative;
        }

        .timeline-item::before {
            content: '';
            width: 8px;
            height: 8px;
            background: var(--accent-color);
            border-radius: 50%;
            position: absolute;
            left: -5px;
            top: 8px;
        }

        .timeline-date {
            font-size: 12px;
            color: var(--text-light);
            margin-bottom: 4px;
            font-weight: 500;
        }

        .outfit-preview {
            padding: 12px;
            background: var(--secondary-color);
            border-radius: 8px;
            font-size: 14px;
            color: var(--text-secondary);
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 16px;
        }

        .stat-item {
            text-align: center;
            padding: 16px;
            background: var(--secondary-color);
            border-radius: 12px;
        }

        .stat-number {
            font-size: 24px;
            font-weight: 700;
            color: var(--accent-color);
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-light);
            font-weight: 500;
        }

        /* Insights */
        .insight-list {
            space-y: 12px;
        }

        .insight-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--secondary-color);
            border-radius: 8px;
            margin-bottom: 8px;
            font-size: 14px;
            color: var(--text-secondary);
        }

        /* Filter Tabs */
        .filter-section {
            margin-bottom: 20px;
        }

        .filter-tabs {
            display: flex;
            background: var(--secondary-color);
            border-radius: 12px;
            padding: 4px;
            gap: 4px;
        }

        .filter-tab {
            flex: 1;
            padding: 8px 12px;
            text-align: center;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            color: var(--text-secondary);
        }

        .filter-tab.active {
            background: var(--accent-color);
            color: white;
        }

        /* Outfit Grid */
        .outfit-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }

        .outfit-card {
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .outfit-card:hover {
            transform: translateY(-2px);
        }

        .outfit-image {
            aspect-ratio: 1;
            background: var(--secondary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: var(--text-light);
        }

        .outfit-image.add-new {
            background: var(--accent-light);
            color: var(--accent-color);
        }

        .outfit-info {
            padding: 12px;
        }

        .outfit-date {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--text-primary);
        }

        .outfit-tags {
            font-size: 12px;
            color: var(--text-light);
        }

        /* Photo Preview Styles */
        .photo-preview-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 8px;
        }

        .photo-preview-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: var(--secondary-color);
            border-radius: 8px;
            font-size: 14px;
            color: var(--text-secondary);
        }

        .photo-preview-item i {
            color: var(--accent-color);
        }

        /* Chat Interface */
        .chat-container {
            display: flex;
            flex-direction: column;
            height: 70vh;
            max-height: 600px;
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            margin: 20px auto 20px auto;
            position: relative;
        }

        .chat-header {
            padding: 8px 20px;
            padding-top: calc(8px + env(safe-area-inset-top, 20px));
            background: var(--gradient-primary);
            color: white;
            text-align: center;
            font-weight: 600;
            font-size: 16px;
            position: sticky;
            top: 0;
            z-index: 10;
            min-height: auto;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            scroll-behavior: smooth;
            padding-bottom: 20px;
            max-height: calc(70vh - 140px);
        }

        .message {
            margin-bottom: 16px;
            display: flex;
            animation: messageSlide 0.3s ease-out;
        }

        @keyframes messageSlide {
            from { transform: translateY(10px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .message.user {
            justify-content: flex-end;
        }

        .message.ai {
            justify-content: flex-start;
        }

        .message-bubble {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 20px;
            font-size: 15px;
            line-height: 1.4;
        }

        .message.user .message-bubble {
            background: var(--accent-color);
            color: white;
            border-bottom-right-radius: 6px;
        }

        .message.ai .message-bubble {
            background: var(--secondary-color);
            color: var(--text-primary);
            border-bottom-left-radius: 6px;
        }

        .reference-images {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .reference-image {
            flex: 1;
            min-width: 100px;
            max-width: 120px;
        }

        .reference-image img {
            width: 100%;
            height: 100px;
            object-fit: cover;
            border-radius: 8px;
            border: 2px solid var(--accent-color);
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .reference-image img:hover {
            transform: scale(1.05);
        }

        .reference-caption {
            text-align: center;
            font-size: 11px;
            color: var(--text-secondary);
            margin-top: 5px;
            font-weight: 500;
        }

        .chat-input-area {
            padding: 16px 20px;
            background: white;
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 12px;
            align-items: center;
            flex-shrink: 0;
            position: relative;
            z-index: 5;
        }

        /* Chat page stability */
        #chatPage {
            position: relative;
            overflow-y: auto;
        }

        .chat-input {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid var(--border-color);
            border-radius: 25px;
            font-size: 15px;
            outline: none;
            transition: border-color 0.2s ease;
        }

        .chat-input:focus {
            border-color: var(--accent-color);
        }

        .send-button {
            width: 44px;
            height: 44px;
            background: var(--accent-color);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .send-button:active {
            transform: scale(0.95);
        }

        /* Loading Animation */
        .loading-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 40px 20px;
            text-align: center;
        }

        .loading-images {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }

        .loading-image {
            width: 60px;
            height: 60px;
            background: var(--accent-light);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--accent-color);
            font-size: 20px;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(0.95); }
        }

        .loading-text {
            font-size: 16px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 1px solid var(--border-color);
            display: flex;
            padding: 12px 0;
            padding-bottom: calc(12px + env(safe-area-inset-bottom, 0px));
            z-index: 1000;
            box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.05);
        }

        .nav-item {
            flex: 1;
            text-align: center;
            padding: 8px 4px;
            cursor: pointer;
            transition: all 0.2s ease;
            border-radius: 12px;
            margin: 0 4px;
        }

        .nav-item.active {
            background: transparent;
        }

        .nav-icon {
            font-size: 20px;
            color: var(--text-light);
            margin-bottom: 4px;
            transition: color 0.2s ease;
        }

        .nav-item.active .nav-icon {
            color: var(--accent-color);
        }

        .nav-label {
            font-size: 11px;
            color: var(--text-light);
            font-weight: 500;
            transition: color 0.2s ease;
        }

        .nav-item.active .nav-label {
            color: var(--accent-color);
        }

        /* Utility Classes */
        .hidden {
            display: none !important;
        }

        .text-center {
            text-align: center;
        }

        .mb-4 {
            margin-bottom: 1rem;
        }

        .mt-4 {
            margin-top: 1rem;
        }

        /* Responsive Design */
        @media (max-width: 375px) {
            .page {
                padding: 16px 16px 100px 16px;
            }
            
            .feature-card {
                padding: 20px;
            }
            
            .logo {
                font-size: 28px;
            }
        }


    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: white; display: flex; align-items: center; justify-content: center; z-index: 9999;">
        <div style="text-align: center;">
            <div style="font-size: 48px; margin-bottom: 20px;">👗</div>
            <div style="font-size: 24px; font-weight: 600; margin-bottom: 10px;">Stylisti</div>
            <div style="font-size: 16px; color: #666;">Loading your style assistant...</div>
        </div>
    </div>

    <!-- Login Page -->
    <div id="loginPage" class="login-container" style="display: none;">
        <div class="login-card">
            <div class="login-logo">Stylisti</div>
                                <div class="login-subtitle">Srusti's personal style assistant</div>
            <div class="login-form">
                <div class="form-group">
                    <label class="form-label">Password</label>
                                                <input type="password" class="form-input" id="loginPassword" placeholder="Enter your password" onkeypress="handlePasswordKeyPress(event)" oninput="clearErrorMessage()">
                </div>
                <button class="login-button" onclick="authenticateUser()">
                    <i class="fas fa-unlock-alt"></i> Unlock
                </button>
                <div class="password-hint">
                    Forgot password? <a href="#" onclick="generatePassword()">Generate new</a>
                </div>
                <div id="errorMessage" class="error-message" style="display: none;"></div>
            </div>
        </div>
    </div>

    <!-- Main App Container -->
    <div class="app" id="mainApp" style="display: none;">

        <!-- Home Page -->
        <div class="page active" id="homePage">
            <div class="header">
                <div class="logo">Stylisti</div>
                <div class="tagline">Srusti's AI powered style assistant</div>
            </div>

            <div class="feature-grid">
                <div class="feature-card" onclick="showPage('uploadPage')">
                    <div class="feature-icon">
                        <i class="fas fa-camera"></i>
                    </div>
                    <div class="feature-title">Upload New Outfit</div>
                    <div class="feature-description">Capture your style and let AI analyze your outfit choices</div>
                </div>

                <div class="feature-card" onclick="showPage('chatPage')">
                    <div class="feature-icon">
                        <i class="fas fa-comments"></i>
                    </div>
                    <div class="feature-title">Chat with Srusti's Stylist</div>
                    <div class="feature-description">Get personalized style advice from your AI fashion consultant</div>
                </div>
            </div>

            <div class="dashboard-grid">
                <div class="dashboard-card" onclick="showPage('calendarPage')">
                    <div class="dashboard-icon">
                        <i class="fas fa-calendar-alt"></i>
                    </div>
                    <div class="dashboard-title">Style Calendar</div>
                    <div class="dashboard-subtitle">Your outfit timeline</div>
                </div>

                <div class="dashboard-card" onclick="showPage('reportsPage')">
                    <div class="dashboard-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="dashboard-title">This Month</div>
                    <div class="dashboard-subtitle">Your style vibe</div>
                </div>

                <div class="dashboard-card" onclick="showPage('plannerPage')">
                    <div class="dashboard-icon">
                        <i class="fas fa-calendar-check"></i>
                    </div>
                    <div class="dashboard-title">Occasion Planner</div>
                    <div class="dashboard-subtitle">Plan your looks</div>
                </div>

                <div class="dashboard-card" onclick="showPage('lookbookPage')">
                    <div class="dashboard-icon">
                        <i class="fas fa-images"></i>
                    </div>
                    <div class="dashboard-title">Lookbook</div>
                    <div class="dashboard-subtitle">Your collection</div>
                </div>
            </div>
        </div>

        <!-- Upload Page -->
        <div class="page" id="uploadPage">
            <div class="header">
                <div class="logo">Upload Outfit</div>
                <div class="tagline">Capture your style moment</div>
            </div>

            <div class="upload-area" onclick="document.getElementById('fileInput').click()">
                <div class="upload-icon">
                    <i class="fas fa-camera"></i>
                </div>
                <div class="upload-text">Take or Choose Photo</div>
                <div class="upload-subtext">JPG, PNG, WebP supported</div>
                <input type="file" id="fileInput" accept="image/*" multiple style="display: none;">
            </div>

            <div id="uploadForm" class="hidden">
                <div class="form-section">
                    <h3 class="form-title">Outfit Details</h3>
                    
                    <div class="form-group">
                        <label class="form-label">Occasion</label>
                        <div class="tag-grid">
                            <div class="tag-option" data-value="work">Work</div>
                            <div class="tag-option" data-value="casual">Casual</div>
                            <div class="tag-option" data-value="date">Date Night</div>
                            <div class="tag-option" data-value="party">Party</div>
                            <div class="tag-option" data-value="formal">Formal</div>
                            <div class="tag-option" data-value="weekend">Weekend</div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Style</label>
                        <div class="tag-grid">
                            <div class="tag-option" data-value="minimalist">Minimalist</div>
                            <div class="tag-option" data-value="bohemian">Bohemian</div>
                            <div class="tag-option" data-value="classic">Classic</div>
                            <div class="tag-option" data-value="edgy">Edgy</div>
                            <div class="tag-option" data-value="romantic">Romantic</div>
                            <div class="tag-option" data-value="sporty">Sporty</div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Mood</label>
                        <div class="tag-grid">
                            <div class="tag-option" data-value="confident">Confident</div>
                            <div class="tag-option" data-value="playful">Playful</div>
                            <div class="tag-option" data-value="elegant">Elegant</div>
                            <div class="tag-option" data-value="comfortable">Comfortable</div>
                            <div class="tag-option" data-value="bold">Bold</div>
                            <div class="tag-option" data-value="relaxed">Relaxed</div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Notes (Optional)</label>
                        <textarea id="outfitNotes" class="form-textarea" placeholder="How did this outfit make you feel? Any special memories?"></textarea>
                    </div>

                    <button class="upload-button" onclick="submitOutfit()">
                        <i class="fas fa-sparkles"></i> Save Outfit
                    </button>
                </div>
            </div>

            <div id="uploadStatus" class="hidden">
                <div class="feature-card text-center">
                    <div class="feature-icon" style="margin: 0 auto 16px;">
                        <i class="fas fa-check" style="color: var(--success-color);"></i>
                    </div>
                    <div class="feature-title" style="color: var(--success-color);">Upload Successful!</div>
                    <div class="feature-description">Your outfit has been added to your collection</div>
                </div>
            </div>
        </div>

        <!-- Chat Page -->
        <div class="page" id="chatPage">
            <div class="chat-container">
                <div class="chat-header">
                    <i class="fas fa-sparkles"></i> Srusti's Stylist
                </div>
                
                <div class="chat-messages" id="chatMessages">
                    <div class="message ai">
                        <div class="message-bubble">
                            Hi! I'm your AI style assistant! 🎨 I've analyzed your wardrobe and I'm ready to help you create amazing outfits. What would you like to explore today?
                            
                            <br><br><strong>💡 Try asking:</strong>
                            <br>• "I'm feeling lazy today, what should I wear?" (recreates exact outfit)
                            <br>• "Mix and match some pieces for me" (creative combinations)
                            <br>• "What should I wear for work?" (context-based recommendations)
                        </div>
                    </div>
                </div>

                <div class="chat-input-area">
                    <input type="text" class="chat-input" id="messageInput" placeholder="Ask me about your style...">
                    <button class="send-button" onclick="sendMessage()">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Style Calendar Page -->
        <div class="page" id="calendarPage">
            <div class="header">
                <div class="logo">Style Calendar</div>
                <div class="tagline">Your outfit timeline</div>
            </div>
            
            <div class="feature-card">
                <div class="feature-title">This Week's Outfits</div>
                <div id="weeklyOutfits" class="timeline">
                    <div class="timeline-item" id="todaysOutfit">
                        <div class="timeline-date">Today</div>
                        <div class="timeline-content">
                            <div class="outfit-preview" id="todayPreview">
                                <i class="fas fa-camera"></i> Upload today's outfit
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="dashboard-grid">
                <div class="dashboard-card">
                    <div class="dashboard-icon">
                        <i class="fas fa-fire"></i>
                    </div>
                    <div class="dashboard-title">7-Day Streak</div>
                    <div class="dashboard-subtitle">Keep it going!</div>
                </div>
                <div class="dashboard-card">
                    <div class="dashboard-icon">
                        <i class="fas fa-heart"></i>
                    </div>
                    <div class="dashboard-title">Favorite Style</div>
                    <div class="dashboard-subtitle">Minimalist</div>
                </div>
            </div>
        </div>

        <!-- Style Reports Page -->
        <div class="page" id="reportsPage">
            <div class="header">
                <div class="logo">Style Reports</div>
                <div class="tagline">Your vibe this month</div>
            </div>
            
            <div class="feature-card">
                <div class="feature-title">Monthly Summary</div>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-number">15</div>
                        <div class="stat-label">Outfits Logged</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">8.2</div>
                        <div class="stat-label">Avg Confidence</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">🎨</div>
                        <div class="stat-label">Top Style: Classic</div>
                    </div>
                </div>
            </div>

            <div class="feature-card">
                <div class="feature-title">Style Insights</div>
                <div class="insight-list">
                    <div class="insight-item">
                        <i class="fas fa-arrow-up" style="color: var(--success-color);"></i>
                        Your confidence has increased 15% this month
                    </div>
                    <div class="insight-item">
                        <i class="fas fa-palette" style="color: var(--accent-color);"></i>
                        You're gravitating towards neutral tones
                    </div>
                    <div class="insight-item">
                        <i class="fas fa-star" style="color: var(--warning-color);"></i>
                        Classic style gives you the most confidence
                    </div>
                </div>
            </div>

            <button class="upload-button" onclick="generateAIReport()">
                <i class="fas fa-magic"></i> Generate AI Report
            </button>
        </div>

        <!-- Occasion Planner Page -->
        <div class="page" id="plannerPage">
            <div class="header">
                <div class="logo">Occasion Planner</div>
                <div class="tagline">Plan your perfect look</div>
            </div>
            
            <div class="form-section">
                <h3 class="form-title">Plan Your Outfit</h3>
                
                <div class="form-group">
                    <label class="form-label">Event Type</label>
                    <div class="tag-grid">
                        <div class="tag-option" data-value="meeting">Meeting</div>
                        <div class="tag-option" data-value="date">Date</div>
                        <div class="tag-option" data-value="wedding">Wedding</div>
                        <div class="tag-option" data-value="interview">Interview</div>
                        <div class="tag-option" data-value="party">Party</div>
                        <div class="tag-option" data-value="casual">Casual</div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">When?</label>
                    <input type="date" id="eventDate" class="form-textarea" style="min-height: auto;">
                </div>

                <div class="form-group">
                    <label class="form-label">Weather</label>
                    <div class="tag-grid">
                        <div class="tag-option" data-value="sunny">☀️&nbsp; Sunny</div>
                        <div class="tag-option" data-value="rainy">🌧️&nbsp; Rainy</div>
                        <div class="tag-option" data-value="cold">❄️&nbsp; Cold</div>
                        <div class="tag-option" data-value="hot">🔥&nbsp; Hot</div>
                        <div class="tag-option" data-value="mild">🌤️&nbsp; Mild</div>
                        <div class="tag-option" data-value="windy">💨&nbsp; Windy</div>
                    </div>
                </div>

                <button class="upload-button" onclick="getOutfitSuggestion()">
                    <i class="fas fa-magic"></i> Get AI Suggestions
                </button>
            </div>

            <div id="suggestionResults" class="hidden">
                <div class="feature-card">
                    <div class="feature-title">AI Recommendation</div>
                    <div id="suggestionContent"></div>
                </div>
            </div>
        </div>

        <!-- Lookbook Page -->
        <div class="page" id="lookbookPage">
            <div class="header">
                <div class="logo">Lookbook</div>
                <div class="tagline">Your style collection</div>
            </div>
            


            <div id="outfitGrid" class="outfit-grid">
                <div class="outfit-card" onclick="viewOutfit(1)">
                    <div class="outfit-image">
                        <i class="fas fa-image"></i>
                    </div>
                    <div class="outfit-info">
                        <div class="outfit-date">Today</div>
                        <div class="outfit-tags">Work • Classic</div>
                    </div>
                </div>
                
                <div class="outfit-card" onclick="viewOutfit(2)">
                    <div class="outfit-image">
                        <i class="fas fa-image"></i>
                    </div>
                    <div class="outfit-info">
                        <div class="outfit-date">Yesterday</div>
                        <div class="outfit-tags">Casual • Comfortable</div>
                    </div>
                </div>
                
                <div class="outfit-card" onclick="showPage('uploadPage')">
                    <div class="outfit-image add-new">
                        <i class="fas fa-plus"></i>
                    </div>
                    <div class="outfit-info">
                        <div class="outfit-date">Add New</div>
                        <div class="outfit-tags">Upload outfit</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <div class="bottom-nav">
            <div class="nav-item active" onclick="setActiveNav(this, 'homePage')">
                <div class="nav-icon"><i class="fas fa-home"></i></div>
                <div class="nav-label">Home</div>
            </div>
            <div class="nav-item" onclick="setActiveNav(this, 'uploadPage')">
                <div class="nav-icon"><i class="fas fa-camera"></i></div>
                <div class="nav-label">Upload</div>
            </div>
            <div class="nav-item" onclick="setActiveNav(this, 'chatPage')">
                <div class="nav-icon"><i class="fas fa-comments"></i></div>
                <div class="nav-label">Chat</div>
            </div>
            <div class="nav-item" onclick="setActiveNav(this, 'lookbookPage')">
                <div class="nav-icon"><i class="fas fa-images"></i></div>
                <div class="nav-label">Lookbook</div>
            </div>
            <div class="nav-item" onclick="setActiveNav(this, 'calendarPage')">
                <div class="nav-icon"><i class="fas fa-calendar-alt"></i></div>
                <div class="nav-label">Calendar</div>
            </div>
        </div>
    </div>
    </div>

    <script>
        // App State Management
        let currentPage = 'homePage';
        let isLoading = false;

        // Page Navigation
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Show target page
            document.getElementById(pageId).classList.add('active');
            currentPage = pageId;
            
            // Load page-specific data
            if (pageId === 'lookbookPage') {
                loadLookbookPhotos();
            } else if (pageId === 'dashboardPage') {
                loadDashboardData();
            } else if (pageId === 'calendarPage') {
                updateTodayOutfit(); // Refresh today's outfit when visiting calendar
                updateStreak(); // Update streak display
            }
            
            // Update navigation
            updateNavigation(pageId);
        }

        function setActiveNav(navItem, pageId) {
            // Remove active from all nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Add active to clicked item
            navItem.classList.add('active');
            
            // Show corresponding page
            showPage(pageId);
        }

        function updateNavigation(pageId) {
            const navItems = document.querySelectorAll('.nav-item');
            const pageToNavMap = {
                'homePage': 0,
                'uploadPage': 1,
                'chatPage': 2,
                'lookbookPage': 3,
                'calendarPage': 4
            };
            
            navItems.forEach((item, index) => {
                item.classList.remove('active');
                if (index === pageToNavMap[pageId]) {
                    item.classList.add('active');
                }
            });
        }

        // Chat Functionality
        async function sendMessage() {
            const messageInput = document.getElementById('messageInput');
            const message = messageInput.value.trim();
            
            if (!message || isLoading) return;
            
            // Add user message
            addMessage(message, true);
            messageInput.value = '';
            
            // Show loading
            showLoadingAnimation();
            isLoading = true;
            
            try {
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message })
                });

                const data = await response.json();
                hideLoadingAnimation();
                
                if (data.success) {
                    // Convert markdown to clean HTML
                    const cleanResponse = formatAIResponse(data.response);
                    addMessage(cleanResponse, false, data.images);
                } else {
                    addMessage('I apologize, but I\'m having trouble processing that request. Could you try again?', false);
                }
            } catch (error) {
                hideLoadingAnimation();
                addMessage('I\'m experiencing connectivity issues. Please check your connection and try again.', false);
            }
            
            isLoading = false;
        }

        function addMessage(content, isUser = false, images = []) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'ai'}`;
            
            const bubbleDiv = document.createElement('div');
            bubbleDiv.className = 'message-bubble';
            bubbleDiv.innerHTML = isUser ? content : content.replace(/\n/g, '<br>');
            
            // Add reference images if they exist
            if (!isUser && images && images.length > 0) {
                const imagesDiv = document.createElement('div');
                imagesDiv.className = 'reference-images';
                
                images.forEach((img, index) => {
                    if (img.url && img.url.length > 0) {
                        const imageContainer = document.createElement('div');
                        imageContainer.className = 'reference-image';
                        
                        const imgElement = document.createElement('img');
                        imgElement.src = img.url;
                        imgElement.alt = `Reference ${index + 1}`;
                        imgElement.onclick = () => zoomImage(imgElement);
                        imgElement.onerror = () => imageContainer.style.display = 'none';
                        
                        const caption = document.createElement('div');
                        caption.className = 'reference-caption';
                        caption.textContent = `Reference ${index + 1}`;
                        
                        imageContainer.appendChild(imgElement);
                        imageContainer.appendChild(caption);
                        imagesDiv.appendChild(imageContainer);
                    }
                });
                
                if (imagesDiv.children.length > 0) {
                    bubbleDiv.appendChild(imagesDiv);
                }
            }
            
            messageDiv.appendChild(bubbleDiv);
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Image zoom function
        function zoomImage(img) {
            if (img.style.transform) {
                img.style.transform = '';
                img.style.zIndex = '';
                img.style.position = '';
            } else {
                img.style.transform = 'scale(2)';
                img.style.zIndex = '1000';
                img.style.position = 'relative';
            }
        }

        function showLoadingAnimation() {
            const chatMessages = document.getElementById('chatMessages');
            const loadingDiv = document.createElement('div');
            loadingDiv.id = 'loadingAnimation';
            loadingDiv.className = 'loading-container';
            loadingDiv.innerHTML = `
                <div class="loading-images">
                    <div class="loading-image"><i class="fas fa-tshirt"></i></div>
                    <div class="loading-image"><i class="fas fa-dress"></i></div>
                    <div class="loading-image"><i class="fas fa-shoe-prints"></i></div>
                </div>
                <div class="loading-text">Analyzing your style...</div>
            `;
            
            chatMessages.appendChild(loadingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function hideLoadingAnimation() {
            const loadingDiv = document.getElementById('loadingAnimation');
            if (loadingDiv) {
                loadingDiv.remove();
            }
        }

        // Global Variables
        let selectedTags = {
            occasion: [],
            style: [],
            mood: [],
            weather: []
        };
        let uploadedFiles = [];

        // Tag Selection Functionality
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('tag-option')) {
                e.target.classList.toggle('selected');
            }
        });

        // Upload Functionality
        document.getElementById('fileInput').addEventListener('change', async (e) => {
            const files = Array.from(e.target.files);
            if (files.length === 0) return;

            uploadedFiles = files;
            
            // Hide upload area and show form for tagging
            document.querySelector('.upload-area').style.display = 'none';
            document.getElementById('uploadForm').classList.remove('hidden');
            
            // Show preview of selected files
            const formSection = document.querySelector('#uploadForm .form-section');
            const existingPreview = document.getElementById('photoPreview');
            if (existingPreview) existingPreview.remove();
            
            const previewDiv = document.createElement('div');
            previewDiv.id = 'photoPreview';
            previewDiv.innerHTML = `
                <div class="form-group">
                    <label class="form-label">Selected Photos (${files.length})</label>
                    <div class="photo-preview-grid">
                        ${Array.from(files).map(file => `
                            <div class="photo-preview-item">
                                <i class="fas fa-image"></i>
                                <span>${file.name}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            formSection.insertBefore(previewDiv, formSection.firstChild.nextSibling);
            
            // Scroll to form
            document.getElementById('uploadForm').scrollIntoView({ behavior: 'smooth' });
        });

        // Submit Outfit with Tags
        async function submitOutfit() {
            if (uploadedFiles.length === 0) return;

            // Collect selected tags
            const occasionTags = Array.from(document.querySelectorAll('#uploadPage .tag-grid:nth-of-type(1) .tag-option.selected')).map(el => el.dataset.value);
            const styleTags = Array.from(document.querySelectorAll('#uploadPage .tag-grid:nth-of-type(2) .tag-option.selected')).map(el => el.dataset.value);
            const moodTags = Array.from(document.querySelectorAll('#uploadPage .tag-grid:nth-of-type(3) .tag-option.selected')).map(el => el.dataset.value);
            const notes = document.getElementById('outfitNotes').value;

            const formData = new FormData();
            uploadedFiles.forEach(file => formData.append('photos', file));
            
            // Add metadata
            formData.append('occasion', JSON.stringify(occasionTags));
            formData.append('style', JSON.stringify(styleTags));
            formData.append('mood', JSON.stringify(moodTags));
            formData.append('notes', notes);

            try {
                // Show upload progress
                document.getElementById('uploadForm').classList.add('hidden');
                document.getElementById('uploadStatus').classList.remove('hidden');
                
                const response = await fetch('/upload-outfit', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();
                if (data.success) {
                    // Show success message immediately
                    document.getElementById('uploadStatus').innerHTML = `
                        <div class="upload-success">
                            <i class="fas fa-check-circle"></i>
                            <div class="feature-title" style="color: var(--success-color);">Upload Successful!</div>
                            <div class="feature-description">Your outfit has been added to your lookbook</div>
                        </div>
                    `;
                    
                    // Update lookbook immediately
                    await loadLookbookPhotos();
                    
                    setTimeout(() => {
                        // Reset form completely
                        document.querySelectorAll('.tag-option.selected').forEach(el => el.classList.remove('selected'));
                        document.getElementById('outfitNotes').value = '';
                        const preview = document.getElementById('photoPreview');
                        if (preview) preview.remove();
                        uploadedFiles = [];
                        
                        // Show upload form again
                        document.getElementById('uploadStatus').classList.add('hidden');
                        document.getElementById('uploadForm').classList.remove('hidden');
                        document.querySelector('.upload-area').style.display = 'block';
                        
                        // Update today's outfit preview in calendar
                        updateTodayOutfit();
                        
                        console.log('✅ Upload complete - form reset and lookbook updated');
                    }, 2000); // Show success message for 2 seconds
                }
            } catch (error) {
                console.error('Upload failed:', error);
                document.getElementById('uploadStatus').classList.add('hidden');
            }
        }

        // Generate AI Report
        async function generateAIReport() {
            try {
                showLoadingAnimation();
                
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        message: 'Generate a detailed monthly style report with insights about my outfit patterns, confidence trends, and style recommendations.'
                    })
                });

                const data = await response.json();
                hideLoadingAnimation();
                
                if (data.success) {
                    // Update the insights section with AI response
                    const insightList = document.querySelector('#reportsPage .insight-list');
                    insightList.innerHTML = `
                        <div class="insight-item">
                            <i class="fas fa-brain" style="color: var(--accent-color);"></i>
                            ${formatAIResponse(data.response)}
                        </div>
                    `;
                }
            } catch (error) {
                hideLoadingAnimation();
                console.error('AI report generation failed:', error);
            }
        }

        // Get Outfit Suggestion
        async function getOutfitSuggestion() {
            // Collect planning data
            const eventType = document.querySelector('#plannerPage .tag-option.selected')?.dataset.value || '';
            const eventDate = document.getElementById('eventDate').value;
            const weather = Array.from(document.querySelectorAll('#plannerPage .tag-grid:nth-of-type(3) .tag-option.selected')).map(el => el.dataset.value);

            if (!eventType) {
                alert('Please select an event type');
                return;
            }

            try {
                showLoadingAnimation();
                
                const message = `I need outfit suggestions for a ${eventType} on ${eventDate}. The weather will be ${weather.join(' and ')}. Please recommend specific items from my wardrobe or suggest what I might need.`;
                
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message })
                });

                const data = await response.json();
                hideLoadingAnimation();
                
                if (data.success) {
                    document.getElementById('suggestionResults').classList.remove('hidden');
                    document.getElementById('suggestionContent').innerHTML = formatAIResponse(data.response);
                    document.getElementById('suggestionResults').scrollIntoView({ behavior: 'smooth' });
                }
            } catch (error) {
                hideLoadingAnimation();
                console.error('Outfit suggestion failed:', error);
            }
        }

        // Filter Outfits
        function filterOutfits(category) {
            // Update active tab
            document.querySelectorAll('.filter-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // Filter functionality would go here - for now, just visual feedback
            console.log('Filtering by:', category);
        }

        // View Outfit Detail
        function viewOutfit(id) {
            // This would show a detailed view of the outfit
            console.log('Viewing outfit:', id);
            alert('Outfit detail view - Coming soon!');
        }

        // Format AI Response - Remove markdown formatting
        function formatAIResponse(response) {
            return response
                // Remove ### headers and replace with <h3>
                .replace(/### (.*?)$/gm, '<h3 style="font-weight: 600; margin: 16px 0 8px 0; color: var(--text-primary);">$1</h3>')
                // Remove ** bold and replace with <strong>
                .replace(/\*\*(.*?)\*\*/g, '<strong style="font-weight: 600; color: var(--text-primary);">$1</strong>')
                // Remove * italic and replace with <em>
                .replace(/\*(.*?)\*/g, '<em style="font-style: italic;">$1</em>')
                // Convert line breaks
                .replace(/\n/g, '<br>')
                // Remove remaining markdown symbols
                .replace(/[#*]/g, '');
        }

        // Show loading with real outfit images
        function showLoadingAnimation() {
            const chatMessages = document.getElementById('chatMessages');
            const loadingDiv = document.createElement('div');
            loadingDiv.id = 'loadingAnimation';
            loadingDiv.className = 'loading-container';
            
            // Load real outfit images for animation
            loadRealPhotosForAnimation().then(photos => {
                loadingDiv.innerHTML = `
                    <div class="loading-images">
                        ${photos.length > 0 ? 
                            photos.slice(0, 3).map(photo => `
                                <div class="loading-image">
                                    <img src="${photo}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 12px;" />
                                </div>
                            `).join('') :
                            `
                                <div class="loading-image"><i class="fas fa-tshirt"></i></div>
                                <div class="loading-image"><i class="fas fa-dress"></i></div>
                                <div class="loading-image"><i class="fas fa-shoe-prints"></i></div>
                            `
                        }
                    </div>
                    <div class="loading-text">Analyzing your style...</div>
                `;
            });
            
            chatMessages.appendChild(loadingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Load real photos for animation from Firebase Storage
        async function loadRealPhotosForAnimation() {
            try {
                const response = await fetch('/api/photos');
                if (response.ok) {
                    const data = await response.json();
                    const photos = data.photos || data;
                    return photos.slice(0, 3).map(photo => photo.url || `/photos/${photo.filename}`);
                }
            } catch (error) {
                console.error('Failed to load photos for animation:', error);
            }
            return [];
        }

        // Load Real Data on Page Load
        async function loadDashboardData() {
            try {
                // Load recent outfits for calendar
                const statsResponse = await fetch('/api/stats');
                if (statsResponse.ok) {
                    const stats = await statsResponse.json();
                    // Update dashboard with real data
                    console.log('Dashboard data loaded:', stats);
                }
                
                // Load today's outfit
                await loadTodaysOutfit();
                
                // Load outfit photos for lookbook
                await loadLookbookPhotos();
            } catch (error) {
                console.error('Failed to load dashboard data:', error);
            }
        }

        // Load today's most recent outfit
        async function loadTodaysOutfit() {
            try {
                const response = await fetch('/api/photos');
                if (response.ok) {
                    const data = await response.json();
                    const photos = data.photos || data;
                    
                    if (photos && photos.length > 0) {
                        // Get the most recent photo (photos are sorted by filename which includes date)
                        const latestPhoto = photos[photos.length - 1];
                        const todayPreview = document.getElementById('todayPreview');
                        
                        if (todayPreview) {
                            todayPreview.innerHTML = `
                                <div style="position: relative; width: 60px; height: 60px; border-radius: 8px; overflow: hidden; margin: 0 auto 8px;">
                                    <img src="${latestPhoto.url || `/photos/${latestPhoto.filename}`}" 
                                         style="width: 100%; height: 100%; object-fit: cover;" 
                                         onerror="this.parentElement.innerHTML='<i class=\\"fas fa-camera\\"></i>'" />
                                </div>
                                <div style="font-size: 11px; color: #8b2635; font-weight: 500;">Latest outfit</div>
                            `;
                        }
                        
                        console.log(`✅ Today's outfit updated with ${latestPhoto.filename}`);
                    }
                }
            } catch (error) {
                console.error('Failed to load today\'s outfit:', error);
            }
        }

        // Update today's outfit preview in calendar
        async function updateTodayOutfit() {
            try {
                const response = await fetch('/api/photos');
                if (response.ok) {
                    const data = await response.json();
                    const photosData = data.photos || data;
                    
                    // Get today's photos (uploaded today)
                    const today = new Date().toISOString().split('T')[0];
                    const todayPhotos = photosData.filter(photo => {
                        const photoDate = photo.filename ? photo.filename.split('-')[0] + '-' + photo.filename.split('-')[1] + '-' + photo.filename.split('-')[2] : '';
                        return photoDate === today;
                    });
                    
                    // Update calendar preview
                    const todayPreview = document.getElementById('todayPreview');
                    if (todayPreview && todayPhotos.length > 0) {
                        const latestPhoto = todayPhotos[todayPhotos.length - 1];
                        todayPreview.innerHTML = '';
                        const imgElement = document.createElement('img');
                        imgElement.src = latestPhoto.url || `/photos/${latestPhoto.filename}`;
                        imgElement.style.cssText = 'width: 100%; height: 100%; object-fit: cover; border-radius: 8px;';
                        todayPreview.appendChild(imgElement);
                        
                        // Update streak
                        updateStreak();
                    }
                }
            } catch (error) {
                console.error('Failed to update today outfit:', error);
            }
        }

        // Update streak tracking
        function updateStreak() {
            const streak = calculateDailyStreak();
            const streakDisplay = document.querySelector('.dashboard-card .dashboard-title');
            if (streakDisplay && streakDisplay.textContent.includes('Streak')) {
                streakDisplay.textContent = `${streak}-Day Streak`;
            }
        }

        // Calculate daily streak based on uploads
        function calculateDailyStreak() {
            // Get stored streak data from localStorage
            const today = new Date().toISOString().split('T')[0];
            const streakData = JSON.parse(localStorage.getItem('styleStreak') || '{"lastUpload": "", "streak": 0}');
            
            const lastUpload = streakData.lastUpload;
            const currentStreak = streakData.streak;
            
            if (lastUpload === today) {
                // Already uploaded today, return current streak
                return currentStreak;
            }
            
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            const yesterdayStr = yesterday.toISOString().split('T')[0];
            
            let newStreak;
            if (lastUpload === yesterdayStr) {
                // Uploaded yesterday, continue streak
                newStreak = currentStreak + 1;
            } else if (lastUpload === '') {
                // First upload ever
                newStreak = 1;
            } else {
                // Gap in uploads, reset streak
                newStreak = 1;
            }
            
            // Update localStorage
            localStorage.setItem('styleStreak', JSON.stringify({
                lastUpload: today,
                streak: newStreak
            }));
            
            return newStreak;
        }

        // Load real photos for lookbook
        async function loadLookbookPhotos() {
            try {
                console.log('🔄 Loading lookbook photos...');
                const response = await fetch('/api/photos');
                if (response.ok) {
                    const data = await response.json();
                    const photosData = data.photos || data; // Handle both {photos: []} and [] formats
                    const outfitGrid = document.getElementById('outfitGrid');
                    
                    if (!outfitGrid) {
                        console.log('Outfit grid not found');
                        return;
                    }
                    
                    // Clear existing content except add new button
                    const addNewCard = outfitGrid.querySelector('.outfit-card:last-child');
                    outfitGrid.innerHTML = '';
                    
                    console.log(`📸 Processing ${photosData.length} photos...`);
                    
                    // Add real photos (show all photos)
                    photosData.forEach((photo, index) => {
                        const outfitCard = document.createElement('div');
                        outfitCard.className = 'outfit-card';
                        outfitCard.onclick = () => viewOutfit(index + 1);
                        
                        const outfitImage = document.createElement('div');
                        outfitImage.className = 'outfit-image';
                        
                        // ALL photos display as actual images from Firebase Storage
                        const imgElement = document.createElement('img');
                        imgElement.src = photo.url || `/photos/${photo.filename}`; // Use Firebase URL if available, fallback to local
                        imgElement.style.cssText = 'width: 100%; height: 100%; object-fit: cover;';
                        imgElement.onerror = function() {
                            // If image fails to load, show a minimal fallback
                            this.parentElement.innerHTML = '<i class="fas fa-image"></i>';
                        };
                        outfitImage.appendChild(imgElement);
                        
                        const outfitInfo = document.createElement('div');
                        outfitInfo.className = 'outfit-info';
                        
                        // Format date properly - use filename date if available
                        let photoDate = new Date();
                        if (photo.uploadDate) {
                            photoDate = new Date(photo.uploadDate);
                        } else if (photo.filename) {
                            // Try to extract date from filename (format: YYYY-MM-DD-outfit-xxx.jpg)
                            const dateMatch = photo.filename.match(/(\d{4}-\d{2}-\d{2})/);
                            if (dateMatch) {
                                photoDate = new Date(dateMatch[1]);
                            }
                        }
                        
                        const dateString = photoDate.toLocaleDateString('en-US', { 
                            month: 'short', 
                            day: 'numeric',
                            year: photoDate.getFullYear() !== new Date().getFullYear() ? 'numeric' : undefined
                        });
                        
                        // Get tags from photo metadata
                        const tags = [];
                        if (photo.occasion && photo.occasion.length > 0) tags.push(photo.occasion[0]);
                        if (photo.style && photo.style.length > 0) tags.push(photo.style[0]);
                        if (tags.length === 0) tags.push('Style');
                        
                        outfitInfo.innerHTML = `
                            <div class="outfit-date">${dateString}</div>
                            <div class="outfit-tags">${tags.join(' • ')}</div>
                        `;
                        
                        outfitCard.appendChild(outfitImage);
                        outfitCard.appendChild(outfitInfo);
                        
                        outfitGrid.appendChild(outfitCard);
                    });
                    
                    // Re-add the "Add New" button
                    if (addNewCard) {
                        outfitGrid.appendChild(addNewCard);
                    }
                    
                    console.log(`✅ Successfully loaded ${photosData.length} photos in lookbook`);
                } else {
                    console.log('❌ No photos endpoint available');
                }
            } catch (error) {
                console.error('❌ Failed to load lookbook photos:', error);
            }
        }

        // Keyboard shortcuts
        document.getElementById('messageInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });



        // Handle keyboard appearance for chat
        let chatMessages = document.getElementById('chatMessages');
        if (chatMessages) {
            // Scroll to bottom when keyboard appears
            window.addEventListener('resize', () => {
                setTimeout(() => {
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }, 100);
            });
        }

        // Drag and drop for upload
        const uploadArea = document.querySelector('.upload-area');
        
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });
        
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            
            const files = Array.from(e.dataTransfer.files);
            if (files.length > 0) {
                document.getElementById('fileInput').files = e.dataTransfer.files;
                document.getElementById('fileInput').dispatchEvent(new Event('change'));
            }
        });

        // Initialize App
        document.addEventListener('DOMContentLoaded', () => {
            console.log('🚀 Stylisti App initializing...');
            
            try {
                loadDashboardData();
                updateStreak(); // Initialize streak display
                updateTodayOutfit(); // Update today's outfit preview
                console.log('✅ App initialized successfully');
                
                // Hide loading screen after successful initialization
                setTimeout(() => {
                    const loadingScreen = document.getElementById('loadingScreen');
                    if (loadingScreen) {
                        loadingScreen.style.display = 'none';
                    }
                }, 1000);
            } catch (error) {
                console.error('❌ Error initializing app:', error);
                // Hide loading screen even if there's an error
                setTimeout(() => {
                    const loadingScreen = document.getElementById('loadingScreen');
                    if (loadingScreen) {
                        loadingScreen.style.display = 'none';
                    }
                }, 2000);
            }
            
            // Listen for upload success from iframe
            window.addEventListener('message', function(event) {
                if (event.data.type === 'outfit-uploaded') {
                    console.log('✅ New outfit uploaded! Refreshing data...');
                    // Refresh all data
                    loadDashboardData();
                    loadTodaysOutfit();
                    loadLookbookPhotos();
                    updateTodayOutfit(); // Update calendar
                    updateStreak(); // Update streak
                    
                    // Show success message and go back to home
                    if (currentPage === 'uploadPage') {
                        setTimeout(() => {
                            showPage('homePage'); // Go back to home after upload
                        }, 1500);
                    }
                }
            });
        });

        // Add error handling for PWA
        window.addEventListener('error', function(e) {
            console.error('❌ JavaScript error:', e.error);
        });

        // Add unhandled rejection handling
        window.addEventListener('unhandledrejection', function(e) {
            console.error('❌ Unhandled promise rejection:', e.reason);
        });

        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        console.log('SW registered: ', registration);
                    })
                    .catch((registrationError) => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }

        // PWA Installation Prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // Show install button if not already installed
            if (!window.matchMedia('(display-mode: standalone)').matches) {
                showInstallPrompt();
            }
        });

        function showInstallPrompt() {
            const installButton = document.createElement('div');
            installButton.innerHTML = `
                <div style="position: fixed; top: 20px; right: 20px; background: #8b2635; color: white; padding: 12px 16px; border-radius: 8px; font-size: 14px; z-index: 1000; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
                    <i class="fas fa-download"></i> Install App
                </div>
            `;
            installButton.onclick = () => {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('User accepted the install prompt');
                    }
                    deferredPrompt = null;
                    installButton.remove();
                });
            };
            document.body.appendChild(installButton);
            
            // Auto-hide after 10 seconds
            setTimeout(() => {
                if (installButton.parentNode) {
                    installButton.remove();
                }
            }, 10000);
        }

        // Login Functionality
        async function authenticateUser() {
            const password = document.getElementById('loginPassword').value;
            
            try {
                const response = await fetch('/verify-login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ password: password })
                });
                
                if (response.ok) {
                    // Hide login page and show main app
                    document.getElementById('loginPage').style.display = 'none';
                    document.getElementById('mainApp').style.display = 'block';
                    console.log('✅ User authenticated successfully!');
                    showPage('homePage'); // Show home page after successful login
                } else {
                    document.getElementById('loginPassword').value = ''; // Clear password field
                    const errorMessage = document.getElementById('errorMessage');
                    errorMessage.textContent = 'Incorrect password. Please try again.';
                    errorMessage.style.display = 'block';
                    console.log('❌ User authentication failed.');
                }
            } catch (error) {
                console.error('Authentication error:', error);
                const errorMessage = document.getElementById('errorMessage');
                errorMessage.textContent = 'Connection error. Please try again.';
                errorMessage.style.display = 'block';
            }
        }

        function generatePassword() {
            const newPassword = Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);
            document.getElementById('loginPassword').value = newPassword;
            alert('New password generated: ' + newPassword);
            console.log('✅ New password generated: ' + newPassword);
        }

        function handlePasswordKeyPress(event) {
            if (event.key === 'Enter') {
                authenticateUser();
            }
        }

        function clearErrorMessage() {
            const errorMessage = document.getElementById('errorMessage');
            errorMessage.style.display = 'none';
        }

        // Initialize app with login flow
        document.addEventListener('DOMContentLoaded', function() {
            // Hide loading screen after a short delay
            setTimeout(() => {
                document.getElementById('loadingScreen').style.display = 'none';
                document.getElementById('loginPage').style.display = 'flex';
            }, 2000);
        });
    </script>
</body>
</html>